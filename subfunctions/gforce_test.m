function gforce_test()
grit_p=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0;0,0,0,0,0,0,0,0,0.324925153289603,1.21866100371835,1.37218781035307,0.781365575614937,0.190543340876809,0,0,0,0,0,0,0,0;0,0,0,0,0,0.155024571956706,1.04876042238546,1.94249627281421,2.83623212324296,3.72996797367171,4.58812214776149,3.99729991302337,3.40647767828524,2.81565544354711,2.22483320880898,0,0,0,0,0,0;0,0,0,0,0.382007640809962,2.14280068442883,3.56006739233881,4.45380324276756,5.34753909319631,6.24127494362506,7.13501079405381,7.21323425043179,6.62241201569366,6.03158978095554,5.44076754621741,2.88114580048089,0.214038845129926,0,0,0,0;0,0,0,0.120303889675784,1.88109693329465,3.64188997691352,5.40268302053238,6.96511021272091,7.85884606314966,8.75258191357841,9.64631776400716,10.4291685878402,9.83834635310209,9.24752411836396,8.65670188362584,6.01386337582002,3.34675642046905,0.679649465118086,0,0,0;0,0,0,1.61939318216047,3.38018622577934,5.14097926939820,6.90177231301707,8.66256535663594,10.3701530331030,11.2638888835318,12.1576247339605,13.0513605843893,13.0542806905105,12.4634584557724,11.8136879065101,9.14658095115914,6.47947399580818,3.81236704045721,0.285592962177606,0,0;0,0,1.35768943102629,3.11848247464516,4.87927551826403,6.64006856188289,8.40086160550176,10.1616546491206,11.9224476927395,13.6832407363584,14.6689317039139,15.5626675543426,16.2702150279189,15.6793927931808,14.9464054818492,12.2792985264983,9.61219157114730,6.55850991424696,1.93207174748624,0,0;0,0,1.86256259902047,3.98991061366841,6.11725862831636,8.13915785436758,9.89995089798645,11.6607439416053,13.4215369852242,15.1823300288430,16.9431230724619,18.0739745242960,18.9677103747247,18.8953271305892,18.0791230571884,15.4120161018374,12.7449091464864,8.20498869955559,3.57855053279488,0,0;0,0.126044861427521,2.25339287607547,4.38074089072341,6.50808890537136,8.63543692001930,10.7627849346672,12.8901329493152,14.9206262777089,16.6814193213277,18.4422123649466,19.1971602195799,19.1971602195799,19.1971602195799,19.1971602195799,18.5447336771765,14.4779056516249,9.85146748486423,5.22502931810351,0.598591151342795,0;0,0.516875138482520,2.64422315313046,4.77157116777841,6.89891918242635,9.02626719707430,11.1536152117222,13.2809632263702,15.4083112410181,17.5356592556661,19.1971602195799,19.1971602195799,19.1971602195799,19.1971602195799,19.1971602195799,19.1971602195799,16.1243844369336,11.4979462701729,6.87150810341215,2.24506993665143,0;0,0.907705415537519,3.03505343018546,5.16240144483341,7.28974945948135,9.41709747412930,11.5444454887772,13.6717935034252,15.7991415180731,17.9264895327211,19.1971602195799,19.1971602195799,19.1971602195799,19.1971602195799,19.1971602195799,19.1971602195799,17.0094154054565,12.0456033712780,7.08179133709942,2.11797930292088,0;0,1.00075516516456,3.06302138507835,5.12528760499215,7.18755382490594,9.24982004481973,11.3120862647335,13.3743524846473,15.4366187045611,17.4988849244749,19.1971602195799,19.1971602195799,19.1971602195799,19.1971602195799,19.1971602195799,19.1971602195799,16.0974780923282,11.1336660581496,6.16985402397109,1.20604198979255,0;0,0.266826069312385,2.32909228922618,4.39135850913997,6.45362472905376,8.51589094896755,10.5781571688813,12.6404233887951,14.7026896087089,16.7649558286227,18.5633352262838,19.1971602195799,19.1971602195799,19.1971602195799,19.1971602195799,18.2769265907129,14.9379496264036,10.2217287450213,5.25791671084276,0.294104676664224,0;0,0,1.59516319337400,3.65742941328779,5.71969563320159,7.78196185311538,9.84422807302917,11.9064942929430,13.6331857910467,15.1861965684835,16.7392073459202,18.2922181233570,18.8424404456104,19.0636781059241,17.8885725129881,15.4342162374497,12.0952392731404,8.75626230883104,4.34597939771443,0,0;0,0,0.861234097521825,2.92350031743562,4.98576653734941,7.04803275726320,8.70303635580956,10.2560471332463,11.8090579106831,13.3620686881199,14.9150794655567,15.5595833303518,16.0690944956716,15.7617507360467,14.5866451431107,12.5915058841865,9.25252891987719,5.91355195556784,2.57457499125849,0,0;0,0,0.127305001669649,2.18957122158344,3.77288692057244,5.32589769800922,6.87890847544600,8.43191925288278,9.98493003031956,11.5379408077563,12.2767262150933,12.7862373804131,13.2957485457328,12.4598233661693,11.2847177732333,9.74879553092334,6.40981856661399,3.07084160230464,0,0,0;0,0,0,0.395748262772099,1.94875904020888,3.50176981764566,5.05478059508243,6.60779137251921,8.16080214995599,8.99386909983479,9.50338026515454,10.0128914304743,10.3330015892279,9.15789599629193,7.98279040335593,6.80768481041993,3.56710821335079,0.228131249041442,0,0,0;0,0,0,0,0.124631159845312,1.67764193728209,3.23065271471887,4.78366349215565,5.71101198457627,6.22052314989602,6.73003431521577,7.23954548053552,7.03107421935052,5.85596862641452,4.68086303347852,3.50575744054252,0.724397860087593,0,0,0,0;0,0,0,0,0,0,1.40652483435530,2.42815486931775,2.93766603463750,3.44717719995725,3.95668836527700,4.46619953059675,3.72914684947312,2.55404125653711,1.37893566360111,0.203830070665112,0,0,0,0,0;0,0,0,0,0,0,0,0,0.164320084698724,0.673831250018475,1.18334241533823,1.60232507253171,0.427219479595708,0,0,0,0,0,0,0,0;0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
%[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0;0,0,0,0,0,0,0,0,0,0.450315953939213,1.57905201882910,1.08961385320975,0,0,0,0,0,0,0,0,0;0,0,0,0,0,0,1.86575739815301,2.99449346304290,4.12322952793278,5.25196559282267,6.38070165771255,7.03097960411784,5.24039874588804,3.44981788765823,1.65923702942842,0,0,0,0,0,0;0,0,0,0,0,2.23869592533821,4.99459026798295,7.75048461062769,8.92487916681624,10.0536152317061,11.1823512965960,12.3110873614859,11.1817644967961,9.39118363856632,7.60060278033651,4.77189884353609,0,0,0,0,0;0,0,0,0,2.41460811632567,5.17050245897041,7.92639680161516,10.6822911442599,13.4381854869046,14.8552648705896,15.9840009354795,17.1127370003694,17.1231302477042,15.3325493894744,13.5419685312446,9.84842690218469,4.44785769305091,0,0,0,0;0,0,0,2.59052030731313,5.34641464995787,8.10230899260262,10.8582033352474,13.6140976778921,16.3699920205369,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,14.9249549608333,9.52438575169951,4.12381654256573,0,0,0;0,0,0.934105256084363,4.27893235300292,7.62375944992147,10.9685865468400,13.7900098688796,16.5459042115243,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,14.6009138103481,9.20034460121433,2.88612535060631,0,0;0,0,1.94215351046347,5.28698060738202,8.63180770430058,11.9766348012191,15.3214618981377,18.6662889950562,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,12.0597920531890,4.63215823475685,0,0;0,0,2.95020176484258,6.29502886176114,9.63985595867969,12.9846830555982,16.3295101525168,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,13.8058249373395,6.37819111890739,0,0;0,0.613422922303140,3.95825001922169,7.30307711614025,10.6479042130588,13.9927313099774,17.3375584068959,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,15.5518578214900,8.12422400305794,0.696590184625831,0;0,1.04683845804702,4.23011009451792,7.41338173098883,10.5966533674597,13.7799250039306,16.9631966404015,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,15.7957857972623,9.43874388098775,2.44262306877637,0;0,0.298538650553930,3.48181028702483,6.66508192349574,9.84835355996664,13.0316251964375,16.2148968329084,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,13.8799304119065,7.52288849563197,1.16584657935747,0;0,0,2.73351047953174,5.91678211600265,9.10005375247355,12.2833253889445,15.4665970254154,18.2997913069354,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.3211169428252,11.9640750265507,5.60703311027619,0,0;0,0,1.98521067203866,5.16848230850956,8.35175394498046,11.2053418846749,13.6184209829996,16.0315000813243,18.4445791796490,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.4287140830760,14.7921773283914,10.0482196411949,3.69117772492041,0,0;0,0,1.23691086454557,4.11089246241431,6.52397156073902,8.93705065906373,11.3501297573884,13.7632088557131,16.1762879540379,18.0001779346385,18.8033426155335,18.8033426155335,18.8033426155335,18.8033426155335,18.1965893828565,14.5600526281719,10.9235158734873,7.28697911880276,1.77532233956463,0,0;0,0,0,1.84260123680317,4.25568033512788,6.66875943345259,9.08183853177730,11.4949176301020,13.4809411994650,14.5275157816339,15.5740903638028,16.6206649459717,16.0436804687834,15.0662999446888,14.0889194205942,10.6913911732679,7.05485441858327,3.41831766389869,0,0,0;0,0,0,0,1.98738910951674,4.40046820784145,6.81354730616616,8.96170446429152,10.0082790464604,11.0548536286293,12.1014282107982,12.8632786852591,11.8858981611644,10.9085176370698,9.93113711297520,6.82272971836378,3.18619296367920,0,0,0,0;0,0,0,0,0,2.13217698223031,4.44246772911802,5.48904231128691,6.53561689345579,7.58219147562468,8.62876605779357,8.70549637764005,7.72811585354544,6.75073532945082,5.77335480535619,2.95406826345971,0,0,0,0,0;0,0,0,0,0,0,0.969805576113407,2.01638015828229,3.06295474045118,4.10952932262007,5.15610390478896,4.54771407002106,3.57033354592644,2.59295302183182,1.61557249773719,0,0,0,0,0,0;0,0,0,0,0,0,0,0,0,0.636867169615457,1.36731228649668,0.389931762402056,0,0,0,0,0,0,0,0,0;0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
h_0=zeros(1,length(grit_p));
F_n=[];F_t=[];A_n=[];A_t=[];
for d_i=0.01:0.01:2
    if d_i==0.25
        ioo=11111;
    end
    dp=max(grit_p,[],'all')-d_i;
    [A_t_temp,A_n_temp]=COF_CAL(grit_p,dp,h_0);
    A_n=[A_n,A_n_temp];
    A_t=[A_t,A_t_temp];
    
    Rarea=0.1;
    g_radius=10;
    a=1;
    alpha=atan((a*(1-Rarea^0.5)/2/a))/pi*180;
    [F_n_temp,F_t_temp]=get_force(d_i,A_n_temp,A_t_temp);%Rarea,g_radius,alpha
    
    F_n=[F_n,F_n_temp];
    F_t=[F_t,F_t_temp];
end
x=0.01:0.01:2;
figure;
plot(x,F_n,'k-',x,F_t,'r-',x,F_t./F_n,'g-');
% figure;
% plot(x,A_n,'k-',x,A_t,'r-');

end

function [A_t,A_n]=COF_CAL(h_ori_grit,dp,h_0)%h_0, ,h_grit,grit_outline
%% res, hmax,

res=.01;miu_r=0;threshold=.01;miu_pu=0;g_res=1;
testmode=3;
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
miu_r_d=miu_r;
h_grit=-h_ori_grit+dp;
w_grit=length(h_grit);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%
grit_outline=min(h_grit);%-round(grit_outline,2);
%%please ensure that h_0 is <0 and grit_outline is also<0
%single
%h_0=0*grit_outline;%round(h_0,2);
h_res= h_0 - (h_0>grit_outline).*(h_0-grit_outline).*(1-miu_r_d);
%%%%%%%%%%%%%%%%%%%%%%%%%%%%

if sum(h_res)==0
    A_t=0;
    A_n=0;
    return
end
grit_outline=min(grit_outline,0);
h_pileup=h_0+(h_0>grit_outline).*(h_0-grit_outline).*miu_pu;
h_max=max((h_0>grit_outline).*(h_0-grit_outline));

g_max=min(grit_outline);

draw_x=1:w_grit;
mark_A_n=0*h_grit;
S_tf=0;
S_tb=0;
A_t=0;
A_n=0;
pu=0;
leftover=0;


%%
for h_i=0:-res:g_max-res
    tbound=[];
    bbound=[];
    
    h_cu=(h_0>=h_i);
    grit_outline_cu=(grit_outline<h_i);
    h_res_cu=(h_res>=h_i);
    h_grit_SUM_cu=sum(h_grit<h_i);
    h_grit_cu=(h_grit<h_i);
    lbound=find(grit_outline_cu,1,'first');
    rbound=find(grit_outline_cu,1,'last');
    for i=1:length(grit_outline)
        tbound_temp=find(h_grit_cu(:,i)>0,1,'first');
        if isempty(tbound_temp)
            tbound_temp=0;
        else
            %%%%%%%%%%%%%%%%%%%%%%%%%%%%
            mark_A_n(tbound_temp,i)=1;
        end
        tbound=[tbound tbound_temp];
        
        bbound_temp=find(h_grit_cu(:,i)>0,1,'last');
        if isempty(bbound_temp) || h_res_cu(i)==0
            bbound_temp=0;
        else
            %%%%%%%%%%%%%%%%%%%%%%%%%%%%%
            mark_A_n(bbound_temp,i)=1;
        end
        bbound=[bbound bbound_temp];
        if i==lbound
            mark_lb=find(h_grit_cu(:,i)>0);
        end
        if i==rbound
            mark_rb=find(h_grit_cu(:,i)>0);
        end
    end
    %%%%%%%%%%%%%%%%%%%%%%%%
    if ~isempty(lbound)
        if length(lbound)>0
            mark_A_n(mark_lb,lbound)=1;
        end
    end
    if ~isempty(rbound)
        if length(rbound)>0
            mark_A_n(mark_rb,rbound)=1;
        end
    end
    %     S_tf=S_tf+length(tbound)-length(bbound);
    %     S_tb=S_tb+sum(h_res_cu.*grit_outline_cu);
    %     bounding=[tbound>0;bbound>0;(tbound>0)-(bbound>0)]';
    A_t=A_t+sum((tbound>0)-(bbound>0));%S_tf-S_tb;
    if bbound==0
        if pu==1
        else
            A_t=A_t+sum(tbound>0)*(-g_max)*(miu_pu/res);
            pu=1;
        end
    end
    
    if   double(h_i)==double(g_max)+double(res)
        leftover=0;
    end
    if sum(h_grit_cu,'all')==0
        mark_A_n=~~(mark_A_n+leftover);
    end
    leftover=h_grit_cu;
    
end

%%deal with empty spaces

for ii=1:length(grit_outline)
    check_mark=mark_A_n(:,ii);
    if sum(check_mark) ~= 0
        mark_A_n(find(check_mark,1,'first'):find(check_mark,1,'last'),ii)=1;
    end
end
if testmode ==1
    figure;
    subplot(1,2,1);
    surf(draw_x,draw_x,double(mark_A_n),'Linestyle','none');
    subplot(1,2,2);
    surf(draw_x,draw_x,double(h_grit<0),'Linestyle','none');
end


A_t=A_t*g_res*res;
A_n=sum(mark_A_n,'all')*g_res*g_res;

if testmode==3
%     figure
    plot(1:length(grit_outline),h_0,'k-',1:length(grit_outline),h_res,'r-',1:length(grit_outline),h_pileup,'b-');
    title([num2str(h_max) ' | ' num2str(A_n) ' | ' num2str(A_t)]);
end

if testmode == 2
    figure
    subplot(1,2,1);
    surf(1:length(grit_outline),1:length(grit_outline),h_grit,'Linestyle','none');
    subplot(1,2,2);
    surf(1:length(grit_outline),1:length(grit_outline),h_grit.*mark_A_n,'Linestyle','none');
    % subplot(2,2,3);
    % plot(1:length(grit_outline),grit_outline,'k-',1:length(grit_outline),h_res,'r-');
    disp('over');
end

end